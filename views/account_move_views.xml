<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="view_account_move_form_inherit_department_approvers" model="ir.ui.view">
        <field name="name">account.move.form.inherit.department.approvers</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@name='journal_div']" position="after">
                <separator string="Department &amp; Approval"/>
                <field name="department_id"/>
                <field name="approval_level_1" attrs="{'readonly': [('approval_level_1_filled', '=', True)]}"/>
                <field name="approval_level_2" attrs="{'readonly': [('approval_level_2_filled', '=', True)]}"/>
                <field name="approval_level_3" attrs="{'readonly': [('approval_level_3_filled', '=', True)]}"/>
                <field name="approval_level_1_filled" invisible="1"/>
                <field name="approval_level_2_filled" invisible="1"/>
                <field name="approval_level_3_filled" invisible="1"/>
            </xpath>


            <xpath expr="//sheet" position="inside">
                <group invisible="1">
                    <field name="approval_1_approved"/>
                    <field name="approval_level_1"/>
                    <field name="approval_2_approved"/>
                    <field name="approval_level_2"/>
                    <field name="approval_3_approved"/>
                    <field name="approval_level_3"/>
                    <field name="current_approver_id"/>
                </group>
            </xpath>

            <xpath expr="//field[@name='state'][@widget='statusbar']" position="attributes">
                <attribute name="statusbar_visible">draft,submitted,approved,posted,cancel</attribute>
            </xpath>

            <xpath expr="//header" position="inside">
                <!-- Submit button only in draft and if approvers set -->
                <button name="action_submit" string="Submit" type="object" class="oe_highlight" states="draft"
                        attrs="{'invisible': ['|',
                        ('department_id', '=', False),
                        '&amp;',
                        ('approval_level_1', '=', False),
                        ('approval_level_2', '=', False),
                        ('approval_level_3', '=', False)
                    ]}"/>

                <!-- Approve button shown only in submitted, only to current approver -->
                <button name="action_approve" string="Approve" type="object" class="btn-primary" states="submitted"
                />

                <!-- Confirm button only in approved attrs="{'invisible': ['|', ('state', '!=', 'submitted'), ('current_approver_id', '!=', uid)]}"-->
                <button name="action_post" string="Confirm" type="object" class="oe_highlight" states="approved"/>
            </xpath>


        </field>
    </record>
</odoo>

<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Inherit existing template -->
        <template id="report_saledetails_custom" inherit_id="point_of_sale.report_saledetails">

            <!-- Add 'Value' and 'Discount' columns to the table header -->
            <xpath expr="//table[.//th[contains(text(), 'Price Unit')]]/thead/tr" position="inside">
                <th>Discount</th>
                <th>Value</th>
                <!--                <th>Final Value</th>-->

            </xpath>

            <!-- Add the computed values for each line -->
            <xpath expr="//table[.//th[contains(text(), 'Price Unit')]]/tbody/tr" position="inside">
                <td>
                    <!-- Discount = line_total * discount% -->
                    <t t-set="discount_value"
                       t-value="(line['quantity'] * line['price_unit']) * (line['discount'] / 100.0)"/>
                    <t t-esc="discount_value" t-options="{'widget': 'float', 'precision': currency_precision}"/>
                </td>
                <!--                <td>-->
                <!--                    &lt;!&ndash; Value = Quantity Ã— Price Unit &ndash;&gt;-->
                <!--                    <t t-set="line_total" t-value="line['quantity'] * line['price_unit']"/>-->
                <!--                    <t t-esc="line_total" t-options="{'widget': 'float', 'precision': currency_precision}"/>-->
                <!--                </td>-->

                <td>
                    <!-- Value = (Quantity Ã— Price Unit) Ã— (1 - Discount%) -->
                    <t t-set="net_total"
                       t-value="line['quantity'] * line['price_unit'] * (1 - (line['discount'] / 100))"/>
                    <t t-esc="net_total" t-options="{'widget': 'float', 'precision': currency_precision}"/>
                </td>


            </xpath>

            <!-- ðŸ”½ Add Discount Total below Taxes Table -->
            <xpath expr="//h3[.='Taxes']/following-sibling::table[1]/following-sibling::br[1]" position="after">
                <h3>Discounts</h3>
                <strong>
                    Total Discounts:
                    <t t-set="total_discount"
                       t-value="sum([line['quantity'] * line['price_unit'] * (line['discount'] / 100.0) for line in products])"/>
                    <t t-esc="total_discount" t-options="{'widget': 'float', 'precision': currency_precision}"/>
                </strong>
            </xpath>

        </template>

    </data>
</odoo>


        <!--<odoo>-->
        <!--    <template id="report_saledetails_extended" inherit_id="point_of_sale.report_saledetails">-->
        <!--        &lt;!&ndash; Add "Values" column header &ndash;&gt;-->
        <!--        <xpath expr="//table[@class='table table-sm'][1]/thead/tr" position="inside">-->
        <!--            <th>Values</th>-->
        <!--        </xpath>-->

        <!--        &lt;!&ndash; Add "Values" column content &ndash;&gt;-->
        <!--        <xpath expr="//table[@class='table table-sm'][1]/tbody/tr" position="inside">-->
        <!--            <td>-->
        <!--                <t t-set="value_amount" t-value="line['quantity'] * line['price_unit']"/>-->
        <!--                <t t-esc="value_amount" t-options="{'widget': 'float', 'precision': currency_precision}"/>-->
        <!--            </td>-->
        <!--        </xpath>-->

        <!--        &lt;!&ndash; Add total value below the product table &ndash;&gt;-->
        <!--        <xpath expr="//table[@class='table table-sm'][1]/following-sibling::br[1]" position="after">-->
        <!--            <strong>-->
        <!--                Total Value:-->
        <!--                <t t-esc="sum([line['quantity'] * line['price_unit'] for line in products])"-->
        <!--                   t-options="{'widget': 'float', 'precision': currency_precision}"/>-->
        <!--            </strong>-->
        <!--        </xpath>-->
        <!--    </template>-->
        <!--</odoo>-->
